# Описание базы данных

---

## Общая информация

База данных разработана для управления личными финансами и организована на основе реляционной модели данных с использованием *
*PostgreSQL** в качестве СУБД и **SQLAlchemy** для работы с ORM (Object-Relational Mapping). Основное внимание уделено гибкости
и расширяемости модели данных, что позволяет легко адаптировать структуру базы к изменениям в бизнес-логике и добавлять новый
функционал.

### Основные сущности:

1. **User** (Пользователь)
2. **Budget** (Бюджет)
3. **Category** (Категория)
4. **Transaction** (Транзакция)
5. **TransactionCategory** (Связь между транзакцией и категорией)

## Основные особенности и продуманность структуры

### 1. Пользователи (User)

Модель **User** представляет пользователей системы и содержит их основные данные:

- `username`: уникальное имя пользователя.
- `hashed_password`: хэшированный пароль для безопасности.
- `email`: опциональное поле для хранения электронной почты пользователя.

**Особенности:**

- Каждый пользователь может иметь несколько **транзакций**, **категорий** и **бюджетов**, что реализовано через отношения *
  *one-to-many**.
- **Username** уникален и не может быть повторен, что предотвращает конфликты при аутентификации.

### 2. Бюджеты (Budget)

Модель **Budget** позволяет пользователям устанавливать бюджеты для своих категорий расходов.

- `amount`: сумма бюджета, которая контролируется пользователем.
- `start_date` и `end_date`: временные границы действия бюджета, что позволяет пользователям задавать бюджеты на разные
  периоды (например, месяц, год).

**Особенности:**

- Модель связывается с пользователем через связь **one-to-many**: один пользователь может иметь несколько бюджетов.
- Модель связывается с категориями через связь **one-to-many**, что позволяет каждой категории принадлежать определенному
  бюджету.
- При удалении пользователя, все его бюджеты также удаляются благодаря опции **ondelete="CASCADE"**.

### 3. Категории (Category)

Модель **Category** предназначена для классификации транзакций. Категории могут быть вложенными (например, "Еда" → "
Рестораны" → "Фастфуд"), что обеспечивается отношением **self-referential** для категории "родитель-потомок".

- `title`: название категории (например, "Еда", "Развлечения").
- `budget_id`: ссылка на бюджет, к которому относится категория.
- `parent_id`: ссылка на родительскую категорию, что позволяет реализовать иерархическую структуру.

**Особенности:**

- Категории поддерживают иерархию (связь **parent-child**), что делает структуру более гибкой. Это позволяет пользователям
  организовывать свои финансы в виде дерева категорий.
- Категории связаны с транзакциями через таблицу-посредника **TransactionCategory** (отношение **many-to-many**), что позволяет
  транзакциям относиться сразу к нескольким категориям.

### 4. Транзакции (Transaction)

Модель **Transaction** представляет отдельные финансовые операции (доходы или расходы).

- `amount`: сумма транзакции.
- `transaction_type`: тип транзакции (например, доход или расход).

**Особенности:**

- Связь с пользователем через отношение **one-to-many**, позволяющее пользователю иметь много транзакций.
- Связь с категориями через таблицу **TransactionCategory**, которая обеспечивает возможность связывания одной транзакции с
  несколькими категориями, реализуя тем самым гибкую систему классификации.

### 5. TransactionCategory (Таблица-посредник)

Модель **TransactionCategory** является ассоциативной таблицей, которая реализует связь **many-to-many** между транзакциями и
категориями.

- `user_id`: ссылка на пользователя, к которому относится транзакция и категория.
- `transaction_id`: ссылка на транзакцию.
- `category_id`: ссылка на категорию.

**Особенности:**

- Для поддержания целостности данных при удалении транзакции или категории, используется опция **ondelete="CASCADE"**, что
  удаляет все связанные записи автоматически.
- Это позволяет системе быть более устойчивой и избавляет от "висящих" записей.

## Особенности проектирования

### 1. Гибкость через каскадное удаление

- **ondelete="CASCADE"** реализовано в большинстве связей, что упрощает управление связанными данными. Если, например,
  пользователь удаляется из системы, все его транзакции, бюджеты и категории удаляются автоматически, что предотвращает
  накопление "мусорных" данных.

### 2. Иерархическая структура категорий

- Категории поддерживают сложную иерархию через связь **parent-child**, что позволяет пользователю организовывать свои траты на
  нескольких уровнях. Такая структура удобна для анализа расходов и позволяет гибко управлять финансами.

### 3. Ассоциативная таблица для транзакций и категорий

- **TransactionCategory** реализует связь **many-to-many** между транзакциями и категориями, что делает модель данных более
  универсальной. Одна транзакция может относиться к нескольким категориям, что позволяет отслеживать многоаспектные траты и
  доходы.

### 4. Временные ограничения для бюджетов

- Модель **Budget** включает временные параметры `start_date` и `end_date`, что позволяет пользователям задавать бюджеты на
  конкретные периоды. Это удобно для планирования бюджета на месяц, квартал или год.

### 5. Четкая структура и разделение ответственности

- Каждая модель отвечает за конкретную область функциональности: пользователи, транзакции, категории и бюджеты имеют четко
  определенные роли и связи между собой, что упрощает масштабирование системы и добавление новых функций.

---
